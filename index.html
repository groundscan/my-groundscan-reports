<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Locating Report - GROUNDSCAN</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .header {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 16px;
            margin-bottom: 24px;
            text-align: center;
            display: flex; /* Added for flexbox layout */
            justify-content: space-between; /* Distribute items */
            align-items: center; /* Vertically align items */
        }
        .header img {
            max-width: 150px; /* Adjust logo size as needed */
            height: auto;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        /* Style for the new Certloc logo */
        #certlocLogo {
            max-width: 100px; /* Adjust size as needed */
            height: auto;
            flex-shrink: 0; /* Prevent it from shrinking */
        }
        /* Placeholder to balance the Certloc logo's width, helping center the main content */
        .header .left-spacer {
            width: 100px; /* Match certlocLogo max-width */
            flex-shrink: 0;
        }
        /* Main company info container to allow centering */
        .header .company-info {
            flex-grow: 1; /* Allows it to take available space and push logos to sides */
            text-align: center;
        }

        .section-title {
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ebf4ff;
        }
        input[type="text"], input[type="date"], input[type="time"], textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus, input[type="date"]:focus, input[type="time"]:focus, textarea:focus, select:focus {
            border-color: #4299e1;
            outline: none;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.25);
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #4a5568;
        }
        .add-button, .get-gps-button {
            background-color: #4299e1;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: inline-block; /* For GPS button */
            margin-top: 5px; /* For GPS button */
        }
        .add-button:hover, .get-gps-button:hover {
            background-color: #3182ce;
        }
        .remove-button {
            background-color: #e53e3e;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.875rem;
        }
        .remove-button:hover {
            background-color: #c53030;
        }
        .service-entry, .photo-entry {
            border: 1px solid #ebf4ff;
            background-color: #f7fafc;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .report-output {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            word-wrap: break-word; /* Break long words */
        }
        .print-button {
            background-color: #38a169;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 20px;
            display: block; /* Make it a block element to center */
            margin-left: auto;
            margin-right: auto;
        }
        .print-button:hover {
            background-color: #2f855a;
        }
        .disclaimer-box {
            background-color: #fffbeb; /* Light yellow background */
            border: 1px solid #fbd38d; /* Yellow border */
            color: #9c4221; /* Darker orange/brown text */
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 24px;
            font-size: 0.95rem;
        }
        .disclaimer-box strong {
            color: #d69e2e; /* Even darker yellow for emphasis */
        }
        .color-legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            border: 1px solid #ccc; /* Add a light border for visibility */
        }
        select[multiple] {
            min-height: 100px; /* Ensure multiple select is visible */
        }

        /* --- Print Specific Styles --- */
        @media print {
            body {
                background-color: #ffffff;
                margin: 0;
                padding: 0;
            }
            .container {
                box-shadow: none;
                margin: 0;
                padding: 0;
                max-width: none;
            }
            .no-print {
                display: none !important;
            }
            .report-output {
                border: none;
                background-color: #ffffff;
                padding: 0;
                margin-top: 0;
                display: block !important; /* Ensure it's visible for print */
                width: 100%;
            }
            input, textarea, select, button {
                border: none !important;
                box-shadow: none !important;
                background-color: transparent !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            .form-group label {
                font-weight: normal;
                color: #000;
            }
            .service-entry, .photo-entry {
                border: none;
                background-color: #ffffff;
                padding: 0;
                margin-bottom: 8px;
            }
            .header {
                border-bottom: 1px solid #000;
                display: flex; /* Ensure flex behavior for print */
                justify-content: space-between;
                align-items: center;
                padding-bottom: 16px;
                margin-bottom: 24px;
            }
            .header .company-info {
                flex-grow: 1;
                text-align: center;
            }
            .header .left-spacer, .header #certlocLogo {
                visibility: visible; /* Ensure logos are visible in print */
                display: block;
            }
            h1, h2, h3 {
                color: #000 !important;
            }
            .disclaimer-box {
                background-color: #ffffff;
                border: 1px solid #000;
                color: #000;
                box-shadow: none;
                page-break-inside: avoid; /* Keep the disclaimer box together */
            }
            .disclaimer-box strong {
                color: #000 !important;
            }
            .color-box {
                border: 1px solid #000;
            }
            /* Ensure images are visible in print */
            .report-output img {
                display: block;
                max-width: 100%;
                height: auto;
                page-break-inside: avoid; /* Ensure image itself doesn't split */
            }
            /* Ensure content breaks gracefully across pages */
            .report-section {
                page-break-inside: avoid; /* Keep entire sections together if possible */
                page-break-after: auto; /* Allow sections to break after if needed */
                margin-bottom: 0.5rem; /* Reduced margin */
                /* Force new page for major sections if content is substantial */
                page-break-before: auto; /* Allow flow, not force new page */
            }
            /* Force Executive Summary to start on a new page */
            .report-output #executiveSummarySection {
                page-break-before: always;
            }
            /* Override for the very first section (Cover Page) so it doesn't start with a blank page */
            .report-output .report-section:first-of-type {
                page-break-before: auto;
            }

            .report-section-title {
                font-size: 1.5rem; /* Larger headings for print */
                font-weight: bold;
                margin-top: 1rem; /* Reduced margin */
                margin-bottom: 0.4rem; /* Reduced margin */
                color: #000;
                border-bottom: 1px solid #000;
                padding-bottom: 0.2rem; /* Reduced padding */
                page-break-after: avoid; /* Keep title with content */
            }
            .report-subsection-title {
                font-size: 1.25rem;
                font-weight: bold;
                margin-top: 0.8rem; /* Reduced margin */
                margin-bottom: 0.4rem; /* Reduced margin */
                color: #000;
                page-break-after: avoid; /* Keep subtitle with content */
            }
            .report-text-block {
                margin-bottom: 0.3rem; /* Reduced margin */
                page-break-inside: auto; /* Allow breaking inside long paragraphs */
            }
            .report-list-item {
                margin-left: 1.2rem; /* Reduced margin */
                margin-bottom: 0.15rem; /* Reduced margin */
            }

            /* NEW/REFINED: Specific rules for generated content blocks to avoid breaking */
            /* Targets the grid container for project info fields */
            .report-output .grid.gap-x-8.gap-y-2 {
                page-break-inside: avoid;
            }
            /* Targets the div containing Quality Levels paragraphs */
            .report-output .mb-6.text-gray-700 {
                page-break-inside: avoid;
            }
            /* Targets the grid container for color legend */
            .report-output .grid.gap-2.text-gray-700 {
                page-break-inside: avoid;
            }
            /* Targets the div for each generated service/photo entry */
            .report-output .mb-4.p-4.border.rounded-lg.bg-gray-50 {
                page-break-inside: avoid;
                display: block; /* Ensure it takes full width for print */
                width: 100%;
            }
            /* Ensure lists stay together */
            .report-output ul.list-disc {
                page-break-inside: avoid;
            }
            /* Try to keep textareas/long text blocks with their labels */
            .report-output .report-text-block.whitespace-pre-wrap {
                page-break-before: avoid;
            }
            .report-output .report-text-block strong {
                page-break-after: avoid; /* Keep bold titles with following text */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- Left Spacer (to help center main content) -->
            <div class="left-spacer"></div>

            <!-- Main Company Info (Centered) -->
            <div class="company-info">
                <img id="companyLogo" src="groundscan_logo.png" alt="GROUNDSCAN Logo" class="mx-auto mb-4" style="max-width: 150px; height: auto;">
                <h1 class="text-3xl font-bold text-gray-800">Utility Locating Report</h1>
                <p class="text-gray-600">Comprehensive Site Assessment</p>
                <div class="text-gray-700 mt-4">
                    <input type="text" id="companyName" class="text-center text-lg font-semibold mb-1" value="GROUNDSCAN" placeholder="Your Company Name (e.g., GROUNDSCAN)">
                    <input type="text" id="companyABN" class="text-center text-sm mb-1" value="ABN: 93 727 813 582" placeholder="ABN: XX XXX XXX XXX">
                    <input type="text" id="companyContact" class="text-center text-sm" value="Phone: 0423407793 | Email: admin@groundscan.com.au" placeholder="Phone: XXXX XXX XXX | Email: info@yourcompany.com">
                </div>
            </div>

            <!-- Certloc Logo on Right -->
            <!-- IMPORTANT: You need to place your Certloc logo file named 'certloc_logo.png'
                 in the SAME folder as this HTML file for it to display correctly. -->
            <img id="certlocLogo" src="certloc_logo.png" alt="CERTLOC Logo">
        </div>

        <div class="no-print">
            <div class="disclaimer-box">
                <p>The following report is an accumulation of information gathered from in-field investigations at the time of the report and any changes of assets in the field cannot be accounted for. It is recommended that services be potholed for confirmation prior to any construction or excavations and a Quality Level A be achieved. This report does not replace the need for valid Dial Before You Dig (DBYD) plans to be always on site.</p>
            </div>

            <h2 class="section-title">Project & Site Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="form-group">
                    <label for="projectName">Project Name:</label>
                    <input type="text" id="projectName" placeholder="e.g., Forestry NSW - Blue Gum Plantation">
                </div>
                <div class="form-group">
                    <label for="clientName">Client Name:</label>
                    <input type="text" id="clientName" placeholder="e.g., Forestry NSW">
                </div>
                <div class="form-group">
                    <label for="clientContactDetails">Client Contact Details:</label>
                    <input type="text" id="clientContactDetails" placeholder="e.g., John Smith, 04XX XXX XXX, john@client.com">
                </div>
                <div class="form-group md:col-span-2">
                    <label for="siteAddress">Site Address/Location:</label>
                    <textarea id="siteAddress" rows="2" placeholder="e.g., Lot 123 DP 123456, Forest Road, Rockley NSW"></textarea>
                    <button type="button" class="get-gps-button" data-target-textarea="siteAddress" data-target-status="siteAddressGpsStatus">Get Current GPS Location</button>
                    <p id="siteAddressGpsStatus" class="text-xs text-gray-500 mt-1"></p>
                </div>
                <div class="form-group">
                    <label for="gpsDeviceUsed">GPS Device Used:</label>
                    <input type="text" id="gpsDeviceUsed" placeholder="e.g., Eos Arrow Gold, iPad">
                </div>
                <div class="form-group">
                    <label for="siteLGA">Local Government Area (LGA):</label>
                    <input type="text" id="siteLGA" placeholder="e.g., Bathurst Regional Council">
                </div>
                <div class="form-group">
                    <label for="projectReferenceNumber">Project Reference Number:</label>
                    <input type="text" id="projectReferenceNumber" placeholder="e.g., PRJ-2025-001">
                </div>
                <div class="form-group">
                    <label for="reportDate">Report Date:</label>
                    <input type="date" id="reportDate">
                </div>
                <div class="form-group">
                    <label for="locatingDate">Locating Date(s):</label>
                    <input type="date" id="locatingDate">
                </div>
                <div class="form-group">
                    <label for="locatorName">Locator Name:</label>
                    <input type="text" id="locatorName" value="Zane Somerville" placeholder="e.g., Zane Smith">
                </div>
                <div class="form-group">
                    <label for="locatorCertificationNumber">Locator Certification Number (e.g., CERTLOC CL-XXXX):</label>
                    <input type="text" id="locatorCertificationNumber" value="00004732" placeholder="e.g., CERTLOC CL-1234">
                </div>
                <div class="form-group">
                    <label for="locatorAccreditation">Accreditation Certificate (Upload for temporary use):</label>
                    <input type="file" id="locatorAccreditation" accept="image/*" onchange="previewImage(event, this, 'locatorAccreditationPreview')">
                    <img id="locatorAccreditationPreview" class="photo-preview mt-2 rounded-lg max-w-full h-auto hidden" style="max-height: 200px;">
                </div>
                <div class="form-group">
                    <label for="equipmentUsed">Equipment Used:</label>
                    <select id="equipmentUsed" multiple class="form-multiselect h-32">
                        <option value="RD8200 (Radio Detection)">RD8200 (Radio Detection)</option>
                        <option value="RD7100 (Radio Detection)">RD7100 (Radio Detection)</option>
                        <option value="GPR (Ground Penetrating Radar)">GPR (Ground Penetrating Radar)</option>
                        <option value="Vivax Metrotech vLoc3-Pro">Vivax Metrotech vLoc3-Pro</option>
                        <option value="Radiodetection RD8000">Radiodetection RD8000</option>
                        <option value="Leica DS2000 GPR">Leica DS2000 GPR</option>
                        <option value="Mala Easy Locator HDR">Mala Easy Locator HDR</option>
                        <option value="Sonde/Transmitter">Sonde/Transmitter</option>
                        <option value="Push Rod Camera">Push Rod Camera</option>
                        <option value="Vaccum Excavator/NDD (Non-Destructive Digging)">Vaccum Excavator/NDD (Non-Destructive Digging)</option>
                        <option value="CCTV Camera">CCTV Camera</option>
                        <option value="Acoustic Leak Detector">Acoustic Leak Detector</option>
                        <option value="Eos Arrow Gold (GPS/GNSS)">Eos Arrow Gold (GPS/GNSS)</option>
                        <option value="Trimble R10 (GPS/GNSS)">Trimble R10 (GPS/GNSS)</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="accuracyAchieved">Accuracy Achieved (AS 5488-2019 QL-B):</label>
                    <select id="accuracyAchieved">
                        <option value="">Select Accuracy</option>
                        <!-- Options will be generated by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="dbydPlansProvided">DBYD Plans Provided?</label>
                    <select id="dbydPlansProvided">
                        <option value="N/A">N/A</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="dbydRefNumbers">DBYD Reference Number(s):</label>
                    <input type="text" id="dbydRefNumbers" placeholder="e.g., 1234567890">
                </div>
                <div class="form-group">
                    <label for="dbydInquiryDate">DBYD Inquiry Date:</label>
                    <input type="date" id="dbydInquiryDate">
                </div>
                <div class="form-group">
                    <label for="sitePlansProvided">Site Specific Plans Provided?</label>
                    <select id="sitePlansProvided">
                        <option value="N/A">N/A</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sitePlansNotes">Site Plans Notes (e.g., "Site clash plan provided for fence installation by a CJV"):</label>
                    <input type="text" id="sitePlansNotes" placeholder="e.g., No site service plans provided">
                </div>
                <div class="form-group md:col-span-2">
                    <label for="siteContext">Site Context (e.g., residential, commercial, greenfield):</label>
                    <textarea id="siteContext" rows="2" placeholder="e.g., Residential property with mature trees and mixed soil conditions."></textarea>
                </div>
                <div class="form-group md:col-span-2">
                    <label for="projectPurpose">Project Scope/Purpose of Survey:</label>
                    <textarea id="projectPurpose" rows="3" placeholder="e.g., To identify underground services prior to excavation for a new building foundation."></textarea>
                </div>
                <div class="form-group md:col-span-2">
                    <label for="surveyAreaDescription">Survey Area Description (specific boundaries/zones):</label>
                    <textarea id="surveyAreaDescription" rows="3" placeholder="e.g., Area within 5m of proposed building footprint, marked with white paint."></textarea>
                </div>
                <div class="form-group md:col-span-2">
                    <label for="environmentalConsiderations">Environmental Considerations (e.g., flood-prone, heritage):</label>
                    <textarea id="environmentalConsiderations" rows="2" placeholder="e.g., Site is located in a flood-prone area; no heritage constraints identified."></textarea>
                </div>
            </div>

            <h2 class="section-title">Executive Summary</h2>
            <div class="form-group mb-6">
                <label for="executiveSummary">Brief Overview, Key Findings, and Scope of Work:</label>
                <textarea id="executiveSummary" rows="8" placeholder="Provide a concise overview of the report's purpose, a summary of located services and critical risks, and the area surveyed."></textarea>
            </div>

            <h2 class="section-title">Quality Levels Explained (AS 5488-2019)</h2>
            <div class="mb-6 text-gray-700">
                <p class="mb-2"><strong>QUALITY LEVEL A (QLA):</strong> Visualization/Confirmation of a service, position, and depth, by non-destructive digging methods or points of entry to pits or manholes. Recommended Quality Level prior to construction or excavation.</p>
                <p class="mb-2"><strong>QUALITY LEVEL B (QLB):</strong> Locating of services using radio detection methods. Acceptable range of accuracy for Quality Level B is +/-300mm for position and +/-500mm for depth.</p>
                <p class="mb-2"><strong>QUALITY LEVEL C (QLC):</strong> Services marked out using only surface features in the field. Surface features include hydrants, gas markers, pits etc. No indication of service location or depth can be attained from Quality Level C.</p>
                <p class="mb-2"><strong>QUALITY LEVEL D (QLD):</strong> Services marked out using DBYD plans only. Offsets on plans can be used to obtain such indication of services in field but no indication of service confirmation can be given from Quality Level D.</p>
            </div>

            <h2 class="section-title">Marking Colour Legend (AS 5488-2019)</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 mb-6 text-gray-700">
                <div class="color-legend-item"><div class="color-box" style="background-color: #FFC0CB;"></div>PINK - GPR/UNKNOWN SERVICE</div>
                <div class="color-legend-item"><div class="color-box" style="background-color: #FFFFFF; border-color: #333;"></div>WHITE - COMMUNICATION SERVICE</div>
                <div class="color-legend-item"><div class="color-box" style="background-color: #FFA500;"></div>ORANGE - ELECTRICAL SERVICE</div>
                <div class="color-legend-item"><div class="color-box" style="background-color: #0000FF;"></div>BLUE - WATER SERVICE</div>
                <div class="color-legend-item"><div class="color-box" style="background-color: #FFFF00; border-color: #333;"></div>YELLOW - GAS SERVICE</div>
                <div class="color-legend-item"><div class="color-box" style="background-color: #008000;"></div>GREEN - STORMWATER SERVICE</div>
                <div class="color-legend-item"><div class="color-box" style="background-color: #800080;"></div>PURPLE - SEWER SERVICE</div>
                 <div class="color-legend-item"><div class="color-box" style="background-color: #A52A2A;"></div>BROWN - PETROLEUM SERVICE</div>
                 <div class="color-legend-item"><div class="color-box" style="background-color: #FF0000;"></div>RED - FIRE SERVICE</div>
                 <div class="color-legend-item"><div class="color-box" style="background-color: #F5F5DC; border-color: #333;"></div>CREAM - SEWER/WASTE WATER</div>
                 <div class="color-legend-item"><div class="color-box" style="background-color: #8A2BE2;"></div>INDIGO - RECYCLED WATER</div>
            </div>

            <h2 class="section-title">Service Details</h2>
            <div id="serviceEntries">
                <!-- Service entries will be added here -->
            </div>
            <button id="addServiceButton" class="add-button mb-6" type="button">+ Add Service Entry</button>

            <h2 class="section-title">Critical Risks & Conflicts</h2>
            <div class="form-group mb-6">
                <label for="criticalRisks">Highlight services in conflict with planned excavation or posing critical risks:</label>
                <textarea id="criticalRisks" rows="4" placeholder="e.g., High-voltage power cable running directly through proposed excavation zone."></textarea>
            </div>

            <h2 class="section-title">Maps and Drawings References</h2>
            <p class="text-sm text-gray-600 mb-4">Note: Physical maps, cross-sections, and CAD/GIS files are external. Please reference them here.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="form-group">
                    <label for="mapReference">Site Plan/Map Reference:</label>
                    <input type="text" id="mapReference" placeholder="e.g., Refer to 'ProjectX_SiteMap_V2.pdf' in Appendices">
                </div>
                <div class="form-group">
                    <label for="cadGisFileReference">CAD/GIS File Reference:</label>
                    <input type="text" id="cadGisFileReference" placeholder="e.g., 'ProjectX_Utilities.dwg' provided separately">
                </div>
                <div class="form-group md:col-span-2">
                    <label for="gpsDatumNote">GPS/GNSS Coordinate Datum Note:</label>
                    <input type="text" id="gpsDatumNote" value="All GPS coordinates are referenced to GDA2020/MGA Zone 56 unless otherwise specified." placeholder="e.g., GDA2020/MGA Zone 56">
                </div>
            </div>

            <h2 class="section-title">Site Photos</h2>
            <p class="text-sm text-gray-600 mb-4">Note: For drawing/editing on photos (e.g., to show service paths), please use your iPad's native photo editing tools (like the Markup feature in the Photos app) *before* uploading the image here. This report does not support in-browser image editing.</p>
            <div id="photoEntries">
                <!-- Photo entries will be added here -->
            </div>
            <button id="addPhotoButton" class="add-button mb-6" type="button">+ Add Photo</button>

            <h2 class="section-title">Safety & Damage Information</h2>
            <div class="form-group mb-4">
                <label for="safetyMeasures">General Safety Measures Taken During Works:</label>
                <textarea id="safetyMeasures" rows="4" placeholder="e.g., Operating under safe work method statement GS01, site induction completed, appropriate PPE worn, exclusion zones established, spotter present."></textarea>
            </div>
            <div class="form-group mb-4">
                <label for="excavationPrecautions">Excavation Precautions (e.g., hand-digging guidelines):</label>
                <textarea id="excavationPrecautions" rows="3" placeholder="e.g., Hand-digging is required within 500mm of all marked services."></textarea>
            </div>
            <div class="form-group mb-4">
                <label for="utilityOwnerCoordinationNotes">Utility Owner Coordination Notes (for further verification):</label>
                <textarea id="utilityOwnerCoordinationNotes" rows="3" placeholder="e.g., Contact Essential Energy for further verification of HV cables prior to excavation."></textarea>
            </div>
            <div class="form-group mb-4">
                <label for="permitsApprovalsNotes">Permits and Approvals Required:</label>
                <textarea id="permitsApprovalsNotes" rows="3" placeholder="e.g., Sydney Water permit required for any work within 1m of sewer main."></textarea>
            </div>
            <div class="form-group mb-6">
                <label for="signageBarriersRecommendations">Signage and Barriers Recommendations:</label>
                <textarea id="signageBarriersRecommendations" rows="3" placeholder="e.g., Install appropriate signage and physical barriers around marked utility corridors."></textarea>
            </div>
            <div class="form-group mb-6">
                <label for="damageFound">Damage to Services Found During Locating (if any):</label>
                <textarea id="damageFound" rows="4" placeholder="e.g., No damage found on Services. Elevated Telstra junction box noted, likely due to livestock rubbing."></textarea>
            </div>


            <h2 class="section-title">Report Summary & Methodology</h2>
            <div class="form-group mb-6">
                <label for="reportSummary">Summary:</label>
                <textarea id="reportSummary" rows="10" placeholder="Describe the methodologies used (RD, GPR, sweep modes) and reiterate key findings and recommendations.">RD (Radio Detection) was used to locate all services using a mixture of Direct Connection, Induction Clamp and Induction. RD was also used on Power Mode, Radio Mode and Passive Mode to sweep the scope of works.

After all surface features have been traced out accordingly, GPR (Ground Penetrating Radar) was then used to scan area of works to confirm assets previously located with RD and to discover any unknown services or anomalies in the ground.

The locations of utilities, which were reported to exist at the time of works, were compiled from a combination of field techniques and available data from co-operating utility authorities through BYDA plans. Whilst all care is taken in locating utilities on site it cannot be guaranteed that the locations determined by this utility investigation are without flaw of any kind. Therefore, it is always highly recommended that the users undertake potholing to directly confirm asset locations where conflict with construction or any excavations may occur, due caution should also be exercised during any excavation activity in places where utilities may reasonably be expected to occur.

All services marked up on site are indicative only.
Completed full sweep of area with EMI, completed full GPR sweep of area.

- Traced and marked for approximate location of services in scope as requested by client.
- Located for live, traceable and visible services only.
- All marks and underground services should be potholed prior to any ground disturbances.
- Highly recommend referring to service plans.
- Cannot Locate earth straps, non-conductive and Irrigation services.
- No design, Construction or service plans provided.
- This service AND REPORT are only a guide.
- Passive scan conducted of entire scope.
- Advise potholing for all services.</textarea>
            </div>

            <h2 class="section-title">General Notes & Observations</h2>
            <div class="form-group mb-6">
                <label for="generalNotes">Notes:</label>
                <textarea id="generalNotes" rows="5" placeholder="Any additional observations, challenges encountered, or recommendations."></textarea>
            </div>

            <h2 class="section-title">Limitations of Survey</h2>
            <div class="form-group mb-6">
                <label for="limitationsOfSurvey">Describe any limitations of the survey:</label>
                <textarea id="limitationsOfSurvey" rows="4" placeholder="e.g., Areas not surveyed due to dense vegetation. GPR effectiveness limited in high-clay content soils."></textarea>
            </div>

            <h2 class="section-title">Compliance with Australian Standard AS 5488-2019 (SUI)</h2>
            <div class="mb-6 text-gray-700">
                <p class="mb-2">This report aims to align with the principles of AS 5488-2019 'Classification of Subsurface Utility Information (SUI)'. Key aspects include:</p>
                <ul class="list-disc list-inside ml-4">
                    <li><strong>Quality Levels:</strong> All reported utility locations are assigned a Quality Level (A, B, C, or D) as defined in this report, indicating the method of acquisition and associated accuracy.</li>
                    <li><strong>Standardized Markings:</strong> On-site markings adhere to the AS 5488 colour legend for consistent communication.</li>
                    <li><strong>Detailed Descriptions:</strong> Each service entry includes details on type, material, depth, location, and notes to provide comprehensive information.</li>
                    <li><strong>Asset Identification:</strong> Unique Asset IDs, Asset Owners, and Asset Status are recorded where applicable, contributing to better utility management.</li>
                    <li><strong>Methodology Transparency:</strong> The report clearly outlines the locating methodologies (e.g., Radio Detection, GPR, connection methods) used for transparency and understanding of data reliability.</li>
                    <li><strong>Effective Communication:</strong> Findings are clearly communicated to project managers, construction teams, and relevant stakeholders to ensure informed decision-making and coordinated excavation.</li>
                    <li><strong>Adherence to "5 Ps":</strong> Our methodology incorporates the industry's "5 Ps" framework (Plan, Prepare, Potentially Pothole, Protect, Proceed) to minimise risks and prevent damage.</li>
                    <li><strong>Disclaimer & Recommendations:</strong> The report includes disclaimers and recommendations for potholing to ensure user safety and project integrity, in line with industry best practices.</li>
                </ul>
                <p class="mt-4">It is recommended that this report be read in conjunction with the full AS 5488-2019 standard for a complete understanding of SUI classification and management.</p>
            </div>

            <h2 class="section-title">References</h2>
            <div class="form-group mb-4">
                <label for="relevantStandardsNotes">Relevant Standards & Guidelines:</label>
                <textarea id="relevantStandardsNotes" rows="3" placeholder="e.g., AS 5488.1-2019, SafeWork NSW Work Health and Safety Regulation 2017."></textarea>
            </div>
            <div class="form-group mb-4">
                <label for="localCouncilUtilityRequirements">Local Council or Utility Provider Specific Requirements:</label>
                <textarea id="localCouncilUtilityRequirements" rows="3" placeholder="e.g., All excavation within 2m of council assets requires specific approval."></textarea>
            </div>

            <h2 class="section-title">Appendices</h2>
            <p class="text-sm text-gray-600 mb-4">Upload relevant supporting documents here.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="form-group">
                    <label for="dbydPlansUpload">DBYD Plans (PDF/Image):</label>
                    <input type="file" id="dbydPlansUpload" accept=".pdf,image/*" multiple onchange="previewFiles(event, 'dbydPlansPreview')">
                    <div id="dbydPlansPreview" class="mt-2 grid grid-cols-2 gap-2"></div>
                </div>
                <div class="form-group">
                    <label for="rawDataUpload">Raw Survey Data (e.g., GPR files, EML logs):</label>
                    <input type="file" id="rawDataUpload" multiple onchange="previewFiles(event, 'rawDataPreview')">
                    <div id="rawDataPreview" class="mt-2 grid grid-cols-2 gap-2"></div>
                </div>
                <div class="form-group">
                    <label for="fieldNotesUpload">Field Notes/Sketches (PDF/Image):</label>
                    <input type="file" id="fieldNotesUpload" accept=".pdf,image/*" multiple onchange="previewFiles(event, 'fieldNotesPreview')">
                    <div id="fieldNotesPreview" class="mt-2 grid grid-cols-2 gap-2"></div>
                </div>
            </div>
            <div class="mb-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
                <h3 class="report-subsection-title">Certificates</h3>
                <p class="report-text-block">Proof of locator certification, including the accreditation certificate image and certification number provided in the Project & Site Information section.</p>
                <div id="generatedCertificateImage" class="mt-2 text-center">
                    <!-- Certificate image will be displayed here -->
                </div>
            </div>
            <div class="mb-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
                <h3 class="report-subsection-title">Glossary</h3>
                <p class="report-text-block"><strong>QL-A:</strong> Quality Level A - Highest accuracy, visual confirmation via non-destructive digging.</p>
                <p class="report-text-block"><strong>QL-B:</strong> Quality Level B - Locating via geophysical methods (e.g., EML, GPR) with specified accuracy range.</p>
                <p class="report-text-block"><strong>QL-C:</strong> Quality Level C - Locating via surface features only.</p>
                <p class="report-text-block"><strong>QL-D:</strong> Quality Level D - Locating via existing records/plans only.</p>
                <p class="report-text-block"><strong>AS 5488.1-2019:</strong> Australian Standard for Classification of Subsurface Utility Information.</p>
                <p class="report-text-block"><strong>DBYD:</strong> Dial Before You Dig - National referral service for identifying underground utilities.</p>
                <p class="report-text-block"><strong>EML:</strong> Electromagnetic Location - Method using electromagnetic fields to detect metallic services.</p>
                <p class="report-text-block"><strong>GPR:</strong> Ground-Penetrating Radar - Method using radar pulses to image the subsurface.</p>
                <p class="report-text-block"><strong>NDD:</strong> Non-Destructive Digging - Excavation methods (e.g., vacuum excavation) that do not damage utilities.</p>
                <p class="report-text-block"><strong>SWMS:</strong> Safe Work Method Statement - Document outlining high-risk work procedures.</p>
                <p class="report-text-block"><strong>JSA:</strong> Job Safety Analysis - Method for breaking down tasks to identify hazards and controls.</p>
                <p class="report-text-block"><strong>APWA Color Codes:</strong> Standardized color markings for different utility types.</p>
                <p class="report-text-block"><strong>GDA2020/MGA Zone:</strong> Geocentric Datum of Australia 2020 / Map Grid of Australia Zone - Australian coordinate system.</p>
            </div>


            <div class="disclaimer-box">
                <p><strong>DISCLAIMER:</strong> This plan includes information describing the location of subterranean features, which were purported to exist at the time of the survey. This information was compiled from a combination of field techniques and available data from cooperating utility authorities. Whilst all care has been taken in the preparation of this plan of survey, <span id="disclaimerCompanyName">GROUNDSCAN</span> cannot guarantee that the plan is without flaw of any kind. Therefore, <span id="disclaimerCompanyName2">GROUNDSCAN</span> expressly disclaims all liability for errors or omissions of any kind whatsoever or from any loss, damage, or other consequences, which may arise from any person relying on anything, stated on this plan. In particular, it is recommended that users satisfy themselves as to the location of subterranean features such as utilities, which may or may not be shown on this plan by deploying AND IMPLEMENTING vacuum excavation techniques.</p>
            </div>

            <button id="printReportButton" class="print-button no-print" type="button">Generate & Print Report</button>
        </div>

        <div id="reportOutput" class="report-output hidden">
            <!-- Generated report will appear here -->
        </div>
    </div>

    <script>
        // Function to get current GPS location and populate a textarea
        function getGpsLocation(textareaId, statusElementId) {
            const textarea = document.getElementById(textareaId);
            const statusElement = document.getElementById(statusElementId);
            if (!navigator.geolocation) {
                statusElement.textContent = 'Geolocation is not supported by your browser.';
                statusElement.style.color = 'red';
                return;
            }

            statusElement.textContent = 'Getting location...';
            statusElement.style.color = 'gray';

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude.toFixed(6);
                    const lon = position.coords.longitude.toFixed(6);
                    const accuracy = position.coords.accuracy ? ` (Accuracy: +/- ${position.coords.accuracy.toFixed(2)}m)` : '';
                    textarea.value = `Lat: ${lat}, Lon: ${lon}${accuracy}`;
                    statusElement.textContent = 'Location obtained.';
                    statusElement.style.color = 'green';
                },
                (error) => {
                    let errorMessage = 'Error getting location: ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'User denied the request for Geolocation.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'The request to get user location timed out.';
                            break;
                        case error.UNKNOWN_ERROR:
                            errorMessage += 'An unknown error occurred.';
                            break;
                    }
                    statusElement.textContent = errorMessage;
                    statusElement.style.color = 'red';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000, // 10 seconds
                    maximumAge: 0 // No cached position
                }
            );
        }

        // Function for site address GPS (now uses data attributes)
        function handleGpsButtonClick(event) {
            const button = event.target;
            const targetTextareaId = button.dataset.targetTextarea;
            const targetStatusId = button.dataset.targetStatus;
            getGpsLocation(targetTextareaId, targetStatusId);
        }

        // Function to add a new service entry block
        function addServiceEntry() {
            const container = document.getElementById('serviceEntries');
            const newEntry = document.createElement('div');
            newEntry.className = 'service-entry grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 relative';
            const entryId = `serviceEntry_${Date.now()}`; // Unique ID for each entry
            newEntry.id = entryId; // Assign the ID

            newEntry.innerHTML = `
                <div class="form-group">
                    <label>Service Type:</label>
                    <select class="service-type">
                        <option value="">Select Type</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Communication">Communication</option>
                        <option value="Water">Water</option>
                        <option value="Sewer">Sewer</option>
                        <option value="Gas">Gas</option>
                        <option value="Stormwater">Stormwater</option>
                        <option value="GPR Anomaly/Unknown">GPR Anomaly/Unknown</option>
                        <option value="Fire Service">Fire Service</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Method of Connection:</label>
                    <select class="method-of-connection">
                        <option value="">Select Method</option>
                        <option value="Direct Connection">Direct Connection</option>
                        <option value="Induction Clamp">Induction Clamp</option>
                        <option value="Induction (Broadcast)">Induction (Broadcast)</option>
                        <option value="Passive (Power)">Passive (Power)</option>
                        <option value="Passive (Radio)">Passive (Radio)</option>
                        <option value="GPR (Ground Penetrating Radar)">GPR (Ground Penetrating Radar)</option>
                        <option value="Visual (Surface Features)">Visual (Surface Features)</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Material:</label>
                    <input type="text" class="service-material" placeholder="e.g., PVC, Copper, Steel, Fibre Optic">
                </div>
                <div class="form-group">
                    <label>Depth (m):</label>
                    <input type="text" class="service-depth" placeholder="e.g., 0.8m">
                </div>
                <div class="form-group">
                    <label>Location (Lat/Lon or Local Grid):</label>
                    <textarea class="service-location" rows="2" placeholder="e.g., -33.1234, 149.5678 or N: 12345, E: 67890"></textarea>
                    <button type="button" class="get-gps-button" data-target-textarea="${entryId}_location" data-target-status="${entryId}_locationStatus">Get GPS</button>
                    <p id="${entryId}_locationStatus" class="text-xs text-gray-500 mt-1"></p>
                </div>
                <div class="form-group">
                    <label>Asset ID (AS 5488-2019):</label>
                    <input type="text" class="asset-id" placeholder="e.g., EL001, CO005">
                </div>
                <div class="form-group">
                    <label>Asset Owner:</label>
                    <input type="text" class="asset-owner" placeholder="e.g., Essential Energy, Telstra">
                </div>
                 <div class="form-group">
                    <label>Asset Status:</label>
                    <select class="asset-status">
                        <option value="">Select Status</option>
                        <option value="Active">Active</option>
                        <option value="Abandoned">Abandoned</option>
                        <option value="Proposed">Proposed</option>
                        <option value="Unknown">Unknown</option>
                    </select>
                </div>
                <div class="form-group md:col-span-2">
                    <label>Description/Notes (e.g., condition, suspected service):</label>
                    <textarea class="service-notes" rows="2" placeholder="e.g., Active 3-phase power cable, Abandoned Telstra conduit"></textarea>
                </div>
                <button class="remove-button absolute top-2 right-2 remove-entry-btn" type="button">Remove</button>
            `;
            container.appendChild(newEntry);
        }

        // Function to add a new photo entry block
        function addPhotoEntry() {
            const container = document.getElementById('photoEntries');
            const newEntry = document.createElement('div');
            newEntry.className = 'photo-entry mb-4 relative';
            const photoId = `photoEntry_${Date.now()}`; // Unique ID for each entry
            newEntry.id = photoId; // Assign the ID

            newEntry.innerHTML = `
                <div class="form-group mb-2">
                    <label>Upload Photo:</label>
                    <input type="file" class="photo-input" accept="image/*" onchange="previewImage(event, this, '${photoId}_preview')">
                    <img id="${photoId}_preview" class="photo-preview mt-2 rounded-lg max-w-full h-auto hidden" style="max-height: 200px;">
                </div>
                <div class="form-group">
                    <label>Photo Caption:</label>
                    <textarea class="photo-caption" rows="1" placeholder="e.g., Water meter and fire service valves"></textarea>
                </div>
                <button class="remove-button absolute top-2 right-2 remove-entry-btn" type="button">Remove</button>
            `;
            container.appendChild(newEntry);
        }

        // Function to preview image after upload (now takes preview ID)
        function previewImage(event, inputElement, previewId) {
            const reader = new FileReader();
            reader.onload = function() {
                const imgElement = document.getElementById(previewId);
                imgElement.src = reader.result;
                imgElement.classList.remove('hidden');
            }
            reader.readAsDataURL(event.target.files[0]);
        }

        // Function to preview multiple files (for appendices)
        function previewFiles(event, previewContainerId) {
            const container = document.getElementById(previewContainerId);
            container.innerHTML = ''; // Clear previous previews
            const files = event.target.files;
            if (files) {
                Array.from(files).forEach(file => {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'text-sm text-gray-600 truncate';
                    if (file.type.startsWith('image/')) {
                        const img = document.createElement('img');
                        img.src = URL.createObjectURL(file);
                        img.className = 'mt-1 rounded-md max-w-full h-auto';
                        img.style.maxHeight = '100px';
                        fileDiv.appendChild(img);
                    }
                    const fileNameSpan = document.createElement('span');
                    fileNameSpan.textContent = file.name;
                    fileDiv.appendChild(fileNameSpan);
                    container.appendChild(fileDiv);
                });
            }
        }


        // Function to generate accuracy options
        function generateAccuracyOptions() {
            const selectElement = document.getElementById('accuracyAchieved');
            selectElement.innerHTML = '<option value="">Select Accuracy</option>'; // Reset options

            // From 1cm to 2m in 10cm increments
            for (let i = 1; i <= 200; i += 10) { // i in cm
                const valueCm = `+/- ${i}cm`;
                selectElement.innerHTML += `<option value="${valueCm}">${valueCm}</option>`;
            }
            // Add the 2m option specifically if not already covered perfectly
            selectElement.innerHTML += `<option value="+/- 2.0m">+/- 2.0m</option>`;
        }


        // Function to generate the report content
        function generateReport() {
            const outputDiv = document.getElementById('reportOutput');
            let reportHtml = ''; // Changed to reportHtml to signify HTML content

            // Get company details for the report
            const companyName = document.getElementById('companyName').value || 'Your Company Name';
            const companyABN = document.getElementById('companyABN').value || 'ABN: Not Provided';
            const companyContact = document.getElementById('companyContact').value || 'Contact: Not Provided';

            // --- Report Header / Cover Page ---
            reportHtml += `<div class="report-section text-center mb-8" style="min-height: 90vh; display: flex; flex-direction: column; justify-content: center; align-items: center;">`;
            reportHtml += `<img src="groundscan_logo.png" alt="GROUNDSCAN Logo" class="mx-auto mb-4" style="max-width: 200px; height: auto;">`; /* Larger for cover */
            reportHtml += `<h1 class="text-4xl font-bold text-gray-800 mb-2">${companyName}</h1>`;
            reportHtml += `<h2 class="text-2xl text-gray-600 mb-8">Utility Locating Report</h2>`;
            reportHtml += `<h3 class="text-xl font-semibold text-gray-700 mb-4">${document.getElementById('projectName').value || 'Project Name Not Provided'}</h3>`;
            reportHtml += `<p class="text-lg text-gray-700 mb-2">${document.getElementById('siteAddress').value || 'Site Address Not Provided'}</p>`;
            reportHtml += `<p class="text-md text-gray-600 mb-8">Report Date: ${document.getElementById('reportDate').value || 'N/A'}</p>`;
            reportHtml += `<div class="mt-auto text-gray-700 text-base">`; /* Pushes contact info to bottom */
            reportHtml += `<p>Prepared by: ${document.getElementById('locatorName').value || 'N/A'}</p>`;
            if (document.getElementById('locatorCertificationNumber').value) {
                reportHtml += `<p>Certification: ${document.getElementById('locatorCertificationNumber').value}</p>`;
            }
            reportHtml += `<p>${companyContact}</p>`;
            reportHtml += `<p class="mt-4">Client: ${document.getElementById('clientName').value || 'N/A'}</p>`;
            if (document.getElementById('clientContactDetails').value) {
                reportHtml += `<p>Client Contact: ${document.getElementById('clientContactDetails').value}</p>`;
            }
            reportHtml += `</div>`;
            // Certloc Logo on Cover Page (smaller, bottom right)
            reportHtml += `<img src="certloc_logo.png" alt="CERTLOC Logo" class="absolute bottom-4 right-4" style="max-width: 80px; height: auto;">`;
            reportHtml += `</div>`; // End Cover Page section


            // --- Executive Summary ---
            reportHtml += `<div class="report-section" id="executiveSummarySection">`; /* Added ID for specific page-break rule */
            reportHtml += `<h2 class="report-section-title">Executive Summary</h2>`;
            reportHtml += `<p class="report-text-block whitespace-pre-wrap">${document.getElementById('executiveSummary').value || 'No executive summary provided.'}</p>`;
            reportHtml += `</div>`;


            // Initial Disclaimer (after Executive Summary)
            reportHtml += `<div class="report-section disclaimer-box mb-8">`;
            reportHtml += `<p>The following report is an accumulation of information gathered from in-field investigations at the time of the report and any changes of assets in the field cannot be accounted for. It is recommended that services be potholed for confirmation prior to any construction or excavations and a Quality Level A be achieved. This report does not replace the need for valid Dial Before You Dig (DBYD) plans to be always on site.</p>`;
            reportHtml += `</div>`;


            // --- Project & Site Information ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Project & Site Information</h2>`;
            reportHtml += `<div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2 text-gray-800 text-base">`;
            reportHtml += `<p><strong>Project Name:</strong> ${document.getElementById('projectName').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Project Reference Number:</strong> ${document.getElementById('projectReferenceNumber').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Client Name:</strong> ${document.getElementById('clientName').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Client Contact Details:</strong> ${document.getElementById('clientContactDetails').value || 'N/A'}</p>`;
            reportHtml += `<p class="md:col-span-2"><strong>Site Address/Location:</strong> ${document.getElementById('siteAddress').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>GPS Device Used:</strong> ${document.getElementById('gpsDeviceUsed').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Local Government Area (LGA):</strong> ${document.getElementById('siteLGA').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Report Date:</strong> ${document.getElementById('reportDate').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Locating Date(s):</strong> ${document.getElementById('locatingDate').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Locator Name:</strong> ${document.getElementById('locatorName').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Locator Certification Number:</strong> ${document.getElementById('locatorCertificationNumber').value || 'N/A'}</p>`;
            reportHtml += `<p class="md:col-span-2"><strong>Accreditation Certificate:</strong> Refer to Appendices for full certificate image.</p>`; /* Simplified for main section */
            
            // Equipment Used (multi-select)
            const selectedEquipment = Array.from(document.getElementById('equipmentUsed').selectedOptions).map(option => option.value);
            reportHtml += `<p><strong>Equipment Used:</strong> ${selectedEquipment.join(', ') || 'N/A'}</p>`;

            reportHtml += `<p><strong>Accuracy Achieved (AS 5488-2019 QL-B):</strong> ${document.getElementById('accuracyAchieved').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>DBYD Plans Provided:</strong> ${document.getElementById('dbydPlansProvided').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>DBYD Reference Number(s):</strong> ${document.getElementById('dbydRefNumbers').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>DBYD Inquiry Date:</strong> ${document.getElementById('dbydInquiryDate').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Site Specific Plans Provided:</strong> ${document.getElementById('sitePlansProvided').value || 'N/A'}</p>`;
            reportHtml += `<p><strong>Site Plans Notes:</strong> ${document.getElementById('sitePlansNotes').value || 'N/A'}</p>`;
            reportHtml += `</div>`;
            reportHtml += `<p class="report-text-block mt-4"><strong>Site Context:</strong> ${document.getElementById('siteContext').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>Project Scope/Purpose of Survey:</strong> ${document.getElementById('projectPurpose').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>Survey Area Description:</strong> ${document.getElementById('surveyAreaDescription').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>Environmental Considerations:</strong> ${document.getElementById('environmentalConsiderations').value || 'N/A'}</p>`;
            reportHtml += `</div>`;


            // --- Quality Levels Explained ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Quality Levels Explained (AS 5488-2019)</h2>`;
            reportHtml += `<p class="report-text-block"><strong>QUALITY LEVEL A (QLA):</strong> Visualization/Confirmation of a service, position, and depth, by non-destructive digging methods or points of entry to pits or manholes. Recommended Quality Level prior to construction or excavation.</p>`;
            reportHtml += `<p class="report-text-block"><strong>QUALITY LEVEL B (QLB):</strong> Locating of services using radio detection methods. Acceptable range of accuracy for Quality Level B is +/-300mm for position and +/-500mm for depth.</p>`;
            reportHtml += `<p class="report-text-block"><strong>QUALITY LEVEL C (QLC):</strong> Services marked out using only surface features in the field. Surface features include hydrants, gas markers, pits etc. No indication of service location or depth can be attained from Quality Level C.</p>`;
            reportHtml += `<p class="report-text-block"><strong>QUALITY LEVEL D (QLD):</strong> Services marked out using DBYD plans only. Offsets on plans can be used to obtain such indication of services in field but no indication of service confirmation can be given from Quality Level D.</p>`;
            reportHtml += `</div>`;

            // --- Marking Colour Legend ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Marking Colour Legend (AS 5488-2019)</h2>`;
            reportHtml += `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 mb-6 text-gray-700 text-base">`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #FFC0CB;"></div>PINK - GPR/UNKNOWN SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #FFFFFF; border-color: #333;"></div>WHITE - COMMUNICATION SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #FFA500;"></div>ORANGE - ELECTRICAL SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #0000FF;"></div>BLUE - WATER SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #FFFF00; border-color: #333;"></div>YELLOW - GAS SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #008000;"></div>GREEN - STORMWATER SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #800080;"></div>PURPLE - SEWER SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #A52A2A;"></div>BROWN - PETROLEUM SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #FF0000;"></div>RED - FIRE SERVICE</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #F5F5DC; border-color: #333;"></div>CREAM - SEWER/WASTE WATER</div>`;
            reportHtml += `<div class="color-legend-item"><div class="color-box" style="background-color: #8A2BE2;"></div>INDIGO - RECYCLED WATER</div>`;
            reportHtml += `</div>`;
            reportHtml += `</div>`;

            // --- Service Details ---
            const serviceEntries = document.querySelectorAll('#serviceEntries .service-entry');
            if (serviceEntries.length > 0) {
                reportHtml += `<div class="report-section">`;
                reportHtml += `<h2 class="report-section-title">Service Details</h2>`;
                serviceEntries.forEach((entry, index) => {
                    const type = entry.querySelector('.service-type').value || 'N/A';
                    const method = entry.querySelector('.method-of-connection').value || 'N/A';
                    const material = entry.querySelector('.service-material').value || 'N/A';
                    const depth = entry.querySelector('.service-depth').value || 'N/A';
                    const location = entry.querySelector('.service-location').value || 'N/A';
                    const assetId = entry.querySelector('.asset-id').value || 'N/A';
                    const assetOwner = entry.querySelector('.asset-owner').value || 'N/A';
                    const assetStatus = entry.querySelector('.asset-status').value || 'N/A';
                    const notes = entry.querySelector('.service-notes').value || 'N/A';

                    reportHtml += `<div class="mb-4 p-4 border border-gray-200 rounded-lg bg-gray-50">`;
                    reportHtml += `<h3 class="report-subsection-title">Service Entry ${index + 1}</h3>`;
                    reportHtml += `<p class="report-text-block"><strong>Type:</strong> ${type}</p>`;
                    reportHtml += `<p class="report-text-block"><strong>Method of Connection:</strong> ${method}</p>`;
                    reportHtml += `<p class="report-text-block"><strong>Material:</strong> ${material}</p>`;
                    reportHtml += `<p class="report-text-block"><strong>Depth:</strong> ${depth}</p>`;
                    reportHtml += `<p class="report-text-block"><strong>Location:</strong> ${location}</p>`;
                    reportHtml += `<p class="report-text-block"><strong>Asset ID (AS 5488-2019):</strong> ${assetId}</p>`;
                    reportHtml += `<p class="report-text-block"><strong>Asset Owner:</strong> ${assetOwner}</p>`;
                    reportHtml += `<p class="report-text-block"><strong>Asset Status:</strong> ${assetStatus}</p>`;
                    reportHtml += `<p class="report-text-block"><strong>Description/Notes (e.g., condition, suspected service):</strong> ${notes}</p>`;
                    reportHtml += `</div>`;
                });
                reportHtml += `</div>`;
            } else {
                reportHtml += `<div class="report-section">`;
                reportHtml += `<h2 class="report-section-title">Service Details</h2>`;
                reportHtml += `<p class="report-text-block">No services recorded.</p>`;
                reportHtml += `</div>`;
            }

            // --- Critical Risks & Conflicts ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Critical Risks & Conflicts</h2>`;
            reportHtml += `<p class="report-text-block whitespace-pre-wrap">${document.getElementById('criticalRisks').value || 'No critical risks or conflicts identified.'}</p>`;
            reportHtml += `</div>`;

            // --- Maps and Drawings References ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Maps and Drawings References</h2>`;
            reportHtml += `<p class="report-text-block"><strong>Site Plan/Map Reference:</strong> ${document.getElementById('mapReference').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>CAD/GIS File Reference:</strong> ${document.getElementById('cadGisFileReference').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>GPS/GNSS Coordinate Datum Note:</strong> ${document.getElementById('gpsDatumNote').value || 'N/A'}</p>`;
            reportHtml += `</div>`;

            // --- Site Photos ---
            const photoEntries = document.querySelectorAll('#photoEntries .photo-entry');
            if (photoEntries.length > 0) {
                reportHtml += `<div class="report-section">`;
                reportHtml += `<h2 class="report-section-title">Site Photos</h2>`;
                photoEntries.forEach((entry, index) => {
                    const imgElement = entry.querySelector('.photo-preview');
                    const caption = entry.querySelector('.photo-caption').value || 'No caption';
                    reportHtml += `<div class="mb-4 p-4 border border-gray-200 rounded-lg bg-gray-50 text-center">`;
                    reportHtml += `<h3 class="report-subsection-title">Photo ${index + 1}: ${caption}</h3>`;
                    if (imgElement && imgElement.src && !imgElement.classList.contains('hidden')) {
                        reportHtml += `<img src="${imgElement.src}" alt="${caption}" class="mx-auto mt-2 rounded-lg max-w-full h-auto" style="max-height: 350px;">`; /* Adjusted max-height */
                    } else {
                        reportHtml += `<p class="text-red-500">Image not available for display in generated report (ensure image was uploaded and visible in form).</p>`;
                    }
                    reportHtml += `</div>`;
                });
                reportHtml += `</div>`;
            } else {
                reportHtml += `<div class="report-section">`;
                reportHtml += `<h2 class="report-section-title">Site Photos</h2>`;
                reportHtml += `<p class="report-text-block">No photos attached.</p>`;
                reportHtml += `</div>`;
            }

            // --- Safety & Damage Information ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Safety & Damage Information</h2>`;
            reportHtml += `<p class="report-text-block"><strong>Duty of Care & Safety Documentation:</strong> All works were conducted with adherence to Duty of Care principles, utilising Safe Work Method Statements (SWMS) and/or Job Safety Analysis (JSA) to ensure safety for personnel, assets, and the public.</p>`;
            reportHtml += `<p class="report-text-block"><strong>Specific Safety Measures Taken During Works:</strong> ${document.getElementById('safetyMeasures').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>Excavation Precautions (e.g., hand-digging guidelines):</strong> ${document.getElementById('excavationPrecautions').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>Utility Owner Coordination Notes (for further verification):</strong> ${document.getElementById('utilityOwnerCoordinationNotes').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>Permits and Approvals Required:</strong> ${document.getElementById('permitsApprovalsNotes').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>Signage and Barriers Recommendations:</strong> ${document.getElementById('signageBarriersRecommendations').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>Damage to Services Found During Locating:</strong> ${document.getElementById('damageFound').value || 'None reported.'}</p>`;
            reportHtml += `</div>`;


            // --- Report Summary & Methodology ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Report Summary & Methodology</h2>`;
            // Preserve line breaks from textarea
            reportHtml += `<p class="report-text-block whitespace-pre-wrap">${document.getElementById('reportSummary').value || 'N/A'}</p>`;
            reportHtml += `</div>`;

            // --- General Notes & Observations ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">General Notes & Observations</h2>`;
            // Preserve line breaks from textarea
            reportHtml += `<p class="report-text-block whitespace-pre-wrap">${document.getElementById('generalNotes').value || 'N/A'}</p>`;
            reportHtml += `</div>`;

            // --- Limitations of Survey ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Limitations of Survey</h2>`;
            reportHtml += `<p class="report-text-block whitespace-pre-wrap">${document.getElementById('limitationsOfSurvey').value || 'No specific limitations reported.'}</p>`;
            reportHtml += `</div>`;

            // --- Compliance with Australian Standard AS 5488-2019 (SUI) ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Compliance with Australian Standard AS 5488-2019 (SUI)</h2>`;
            reportHtml += `<p class="mb-2">This report aims to align with the principles of AS 5488-2019 'Classification of Subsurface Utility Information (SUI)'. Key aspects include:</p>`;
            reportHtml += `<ul class="list-disc list-inside ml-4">`;
            reportHtml += `<li class="report-list-item"><strong>Quality Levels:</strong> All reported utility locations are assigned a Quality Level (A, B, C, or D) as defined in this report, indicating the method of acquisition and associated accuracy.</li>`;
            reportHtml += `<li class="report-list-item"><strong>Standardized Markings:</strong> On-site markings adhere to the AS 5488 colour legend for consistent communication.</li>`;
            reportHtml += `<li class="report-list-item"><strong>Detailed Descriptions:</strong> Each service entry includes details on type, material, depth, location, and notes to provide comprehensive information.</li>`;
            reportHtml += `<li class="report-list-item"><strong>Asset Identification:</strong> Unique Asset IDs, Asset Owners, and Asset Status are recorded where applicable, contributing to better utility management.</li>`;
            reportHtml += `<li class="report-list-item"><strong>Methodology Transparency:</strong> The report clearly outlines the locating methodologies (e.g., Radio Detection, GPR, connection methods) used for transparency and understanding of data reliability.</li>`;
            reportHtml += `<li class="report-list-item"><strong>Effective Communication:</strong> Findings are clearly communicated to project managers, construction teams, and relevant stakeholders to ensure informed decision-making and coordinated excavation.</li>`;
            reportHtml += `<li class="report-list-item"><strong>Adherence to "5 Ps":</strong> Our methodology incorporates the industry's "5 Ps" framework (Plan, Prepare, Potentially Pothole, Protect, Proceed) to minimise risks and prevent damage.</li>`;
            reportHtml += `<li class="report-list-item"><strong>Disclaimer & Recommendations:</strong> The report includes disclaimers and recommendations for potholing to ensure user safety and project integrity, in line with industry best practices.</li>`;
            reportHtml += `</ul>`;
            reportHtml += `<p class="mt-4">It is recommended that this report be read in conjunction with the full AS 5488-2019 standard for a complete understanding of SUI classification and management.</p>`;
            reportHtml += `</div>`;

            // --- References ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">References</h2>`;
            reportHtml += `<p class="report-text-block"><strong>Relevant Standards & Guidelines:</strong> ${document.getElementById('relevantStandardsNotes').value || 'N/A'}</p>`;
            reportHtml += `<p class="report-text-block"><strong>DBYD Inquiry Number and Date:</strong> ${document.getElementById('dbydRefNumbers').value || 'N/A'} (Inquiry Date: ${document.getElementById('dbydInquiryDate').value || 'N/A'})</p>`;
            reportHtml += `<p class="report-text-block"><strong>Local Council or Utility Provider Specific Requirements:</strong> ${document.getElementById('localCouncilUtilityRequirements').value || 'N/A'}</p>`;
            reportHtml += `</div>`;

            // --- Appendices ---
            reportHtml += `<div class="report-section">`;
            reportHtml += `<h2 class="report-section-title">Appendices</h2>`;
            
            // DBYD Plans
            const dbydFiles = document.getElementById('dbydPlansUpload').files;
            if (dbydFiles.length > 0) {
                reportHtml += `<h3 class="report-subsection-title">DBYD Plans</h3>`;
                Array.from(dbydFiles).forEach(file => {
                    reportHtml += `<p class="report-text-block">${file.name} (File Type: ${file.type}, Size: ${(file.size / 1024).toFixed(2)} KB)</p>`;
                });
            } else {
                reportHtml += `<h3 class="report-subsection-title">DBYD Plans</h3>`;
                reportHtml += `<p class="report-text-block">No DBYD plans uploaded.</p>`;
            }

            // Raw Survey Data
            const rawDataFiles = document.getElementById('rawDataUpload').files;
            if (rawDataFiles.length > 0) {
                reportHtml += `<h3 class="report-subsection-title">Raw Survey Data</h3>`;
                Array.from(rawDataFiles).forEach(file => {
                    reportHtml += `<p class="report-text-block">${file.name} (File Type: ${file.type}, Size: ${(file.size / 1024).toFixed(2)} KB)</p>`;
                });
            } else {
                reportHtml += `<h3 class="report-subsection-title">Raw Survey Data</h3>`;
                reportHtml += `<p class="report-text-block">No raw survey data uploaded.</p>`;
            }

            // Field Notes
            const fieldNotesFiles = document.getElementById('fieldNotesUpload').files;
            if (fieldNotesFiles.length > 0) {
                reportHtml += `<h3 class="report-subsection-title">Field Notes/Sketches</h3>`;
                Array.from(fieldNotesFiles).forEach(file => {
                    reportHtml += `<p class="report-text-block">${file.name} (File Type: ${file.type}, Size: ${(file.size / 1024).toFixed(2)} KB)</p>`;
                });
            } else {
                reportHtml += `<h3 class="report-subsection-title">Field Notes/Sketches</h3>`;
                reportHtml += `<p class="report-text-block">No field notes/sketches uploaded.</p>`;
            }

            // Certificates
            reportHtml += `<h3 class="report-subsection-title">Certificates</h3>`;
            if (document.getElementById('locatorCertificationNumber').value) {
                reportHtml += `<p class="report-text-block">Locator Certification Number: ${document.getElementById('locatorCertificationNumber').value}</p>`;
            }
            // Hardcoded certificate image
            reportHtml += `<p class="report-text-block">Accreditation Certificate:</p><img src="my_certloc_certificate.png" alt="Accreditation Certificate" class="mx-auto mt-2 rounded-lg max-w-full h-auto" style="max-height: 300px;">`;
            
            // Glossary
            reportHtml += `<h3 class="report-subsection-title">Glossary</h3>`;
            reportHtml += `<p class="report-text-block"><strong>QL-A:</strong> Quality Level A - Highest accuracy, visual confirmation via non-destructive digging.</p>`;
            reportHtml += `<p class="report-text-block"><strong>QL-B:</strong> Quality Level B - Locating via geophysical methods (e.g., EML, GPR) with specified accuracy range.</p>`;
            reportHtml += `<p class="report-text-block"><strong>QL-C:</strong> Quality Level C - Locating via surface features only.</p>`;
            reportHtml += `<p class="report-text-block"><strong>QL-D:</strong> Quality Level D - Locating via existing records/plans only.</p>`;
            reportHtml += `<p class="report-text-block"><strong>AS 5488.1-2019:</strong> Australian Standard for Classification of Subsurface Utility Information.</p>`;
            reportHtml += `<p class="report-text-block"><strong>DBYD:</strong> Dial Before You Dig - National referral service for identifying underground utilities.</p>`;
            reportHtml += `<p class="report-text-block"><strong>EML:</strong> Electromagnetic Location - Method using electromagnetic fields to detect metallic services.</p>`;
            reportHtml += `<p class="report-text-block"><strong>GPR:</strong> Ground-Penetrating Radar - Method using radar pulses to image the subsurface.</p>`;
            reportHtml += `<p class="report-text-block"><strong>NDD:</strong> Non-Destructive Digging - Excavation methods (e.g., vacuum excavation) that do not damage utilities.</p>`;
            reportHtml += `<p class="report-text-block"><strong>SWMS:</strong> Safe Work Method Statement - Document outlining high-risk work procedures.</p>`;
            reportHtml += `<p class="report-text-block"><strong>JSA:</strong> Job Safety Analysis - Method for breaking down tasks to identify hazards and controls.</p>`;
            reportHtml += `<p class="report-text-block"><strong>APWA Color Codes:</strong> Standardized color markings for different utility types.</p>`;
            reportHtml += `<p class="report-text-block"><strong>GDA2020/MGA Zone:</strong> Geocentric Datum of Australia 2020 / Map Grid of Australia Zone - Australian coordinate system.</p>`;
            reportHtml += `</div>`;
            reportHtml += `</div>`;


            // --- Final Disclaimer ---
            reportHtml += `<div class="disclaimer-box report-section">`; /* Added report-section class here too */
            reportHtml += `<p><strong>DISCLAIMER:</strong> This plan includes information describing the location of subterranean features, which were purported to exist at the time of the survey. This information was compiled from a combination of field techniques and available data from cooperating utility authorities. Whilst all care has been taken in the preparation of this plan of survey, <span id="disclaimerCompanyNameOutput">${companyName}</span> cannot guarantee that the plan is without flaw of any kind. Therefore, <span id="disclaimerCompanyNameOutput2">${companyName}</span> expressly disclaims all liability for errors or omissions of any kind whatsoever or from any loss, damage, or other consequences, which may arise from any person relying on anything, stated on this plan. In particular, it is recommended that users satisfy themselves as to the location of subterranean features such as utilities, which may or may not be shown on this plan by deploying AND IMPLEMENTING vacuum excavation techniques.</p>`;
            reportHtml += `</div>`;


            outputDiv.innerHTML = reportHtml; // Set the innerHTML directly
            outputDiv.classList.remove('hidden');

            // Trigger print dialog
            window.print();
        }

        // This function runs once the entire HTML document is loaded and parsed.
        window.onload = function() {
            // Get references to the buttons
            const addServiceButton = document.getElementById('addServiceButton');
            const addPhotoButton = document.getElementById('addPhotoButton');
            const printReportButton = document.getElementById('printReportButton');

            // Attach event listeners to the buttons
            addServiceButton.addEventListener('click', addServiceEntry);
            addPhotoButton.addEventListener('click', addPhotoEntry);
            printReportButton.addEventListener('click', generateReport);

            // Event Delegation for Remove Buttons (listen on parent containers)
            const serviceEntriesContainer = document.getElementById('serviceEntries');
            const photoEntriesContainer = document.getElementById('photoEntries');

            serviceEntriesContainer.addEventListener('click', function(event) {
                if (event.target.classList.contains('remove-entry-btn')) {
                    event.target.closest('.service-entry').remove();
                }
            });
            photoEntriesContainer.addEventListener('click', function(event) {
                if (event.target.classList.contains('remove-entry-btn')) {
                    event.target.closest('.photo-entry').remove();
                }
            });

            // Event delegation for all GPS buttons
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('get-gps-button')) {
                    handleGpsButtonClick(event);
                }
            });


            // Initial Load: Add one service and one photo entry
            addServiceEntry();
            addPhotoEntry();

            // Set current date for reportDate and locatingDate
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months start at 0!
            const dd = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${yyyy}-${mm}-${dd}`;
            document.getElementById('reportDate').value = formattedDate;
            document.getElementById('locatingDate').value = formattedDate;
            document.getElementById('dbydInquiryDate').value = formattedDate; // Set DBYD Inquiry Date too

            // Generate accuracy options on load
            generateAccuracyOptions();

            // Set default company name in disclaimer for initial load and update dynamically
            const companyNameInput = document.getElementById('companyName');
            const updateCompanyNameInDisclaimers = function() {
                const currentCompanyName = companyNameInput.value || companyNameInput.placeholder.replace('Your Company Name (e.g., ', '').replace(')', '');
                // Update the hidden spans in the disclaimer for the generated report
                document.getElementById('disclaimerCompanyName').textContent = currentCompanyName;
                document.getElementById('disclaimerCompanyName2').textContent = currentCompanyName;
            };

            // Initial call to set company name in disclaimers
            updateCompanyNameInDisclaimers();

            // Listen for changes to the company name input
            companyNameInput.addEventListener('input', updateCompanyNameInDisclaimers);
        };
    </script>
</body>
</html>
